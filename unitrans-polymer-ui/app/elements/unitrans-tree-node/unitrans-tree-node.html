<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="unitrans-tree-node" attributes="node">
    <template>
        <core-item label="{{title}}" />
        <div>
            <template repeat="{{ subnode in subnodes }}">
                <unitrans-tree-node node="{{subnode}}"/>
            </template>
        </div>
        <core-ajax
                   auto
                   id="metaData"
                   url="{{node.url}}"
                   on-core-response="{{metaDownloaded}}"
                   on-core-error="this.$.failedToast.show()"
                   handleAs="json">
        </core-ajax>
        <paper-toast id="failedToast" text="Failed to load {{node.url}}"></paper-toast>
    </template>
    <script>
        (function () {
            'use strict';

            Polymer({
                metaDownloaded: function() {
                   var meta = this.$.metaData.response;
                   this.title = meta.meta.name;
                   this.subnodes = meta.metaBlockList.map(function(v){
                       return {url: encodeURI("/api/metadata/" + v)};
                   });
                   console.log("Downloaded", this.$.metaData.response);
                }
            });

        })();
    </script>
</polymer-element>
